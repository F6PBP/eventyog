{% extends "ds/modal.html" %}
{% block modal_body %}
<div id="{{ modal_id }}"
  class="fixed inset-0 flex items-center justify-center z-50 hidden bg-black bg-opacity-50 transition-opacity duration-300">
  <div
    class="bg-white rounded-lg shadow-lg w-full max-w-lg transform transition-transform duration-300 scale-95 flex flex-col {{ modal_class }}">
    <div class="flex justify-between items-center p-5 border-b">
      <h5 class="text-lg font-semibold">{{ modal_title }}</h5>
      <button type="button" class="text-gray-500 hover:text-gray-700 closeModalButton" aria-label="Close"
        data-modal-id="{{ modal_id }}">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="bg-white p-6 form-style">
      <form method="POST" class="space-y-6">
        {% csrf_token %}
        {% for field in form %}
        <div class="flex flex-col">
          <label for="{{ field.id_for_label }}" class="mb-2 font-semibold text-gray-700">
            {{ field.label }}
          </label>
          <div class="w-full">
            {{ field }}
          </div>
          {% if field.help_text %}
          <p class="mt-1 text-sm text-gray-500">{{ field.help_text }}</p>
          {% endif %}
          {% for error in field.errors %}
          <p class="mt-1 text-sm text-red-600">{{ error }}</p>
          {% endfor %}
        </div>
        {% endfor %}
      </form>
    </div>

    <div class="flex justify-end p-4 border-t gap-2">
      <button
        class="flex items-center justify-center gap-2 py-3 px-10 text-white text-xs md:text-sm font-semibold rounded-xl hover:scale-105 duration-300 bg-gray-500 closeModalButton"
        data-modal-id="{{ modal_id }}">
        Cancel
      </button>
      <button
        class="flex items-center justify-center gap-2 py-3 px-10 text-white text-xs md:text-sm font-semibold rounded-xl hover:scale-105 duration-300 bg-indigo-600"
        onclick="executeOnSubmit('submitCreateMerchandiseForm', '{{ modal_id }}')">
        Save Changes
      </button>
    </div>
  </div>
</div>

<script>
  document.getElementById('openModalButton').addEventListener('click', function () {
    const modal = document.getElementById('{{ modal_id }}');
    modal.classList.remove('hidden');
    setTimeout(() => {
      modal.classList.remove('opacity-0');
      modal.querySelector('div').classList.remove('scale-95');
    }, 10);
  });

  function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.classList.add('opacity-0');
    modal.querySelector('div').classList.add('scale-95');
    setTimeout(() => {
      modal.classList.add('hidden');
    }, 300);
  }

  document.querySelectorAll('.closeModalButton').forEach(button => {
    button.addEventListener('click', function () {
      closeModal(this.getAttribute('data-modal-id'));
    });
  });

  document.getElementById('{{ modal_id }}').addEventListener('click', function (event) {
    if (event.target === this) {
      closeModal(this.id);
    }
  });

  function executeOnSubmit(onsubmit, modalId) {
    if (typeof window[onsubmit] === 'function') {
      window[onsubmit]();
    }
    closeModal(modalId);
  }

  function submitCreateMerchandiseForm() {
    document.querySelector('#{{ modal_id }} form').submit();
  }
</script>

<style>
  #{{ modal_id }
  }

  .hidden {
    opacity: 0;
  }
</style>
{% endblock %}